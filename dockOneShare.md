用Docker和Git搭建在线开发环境
====
#自我介绍
##分享人
王延祺
##介绍
王延祺，IBM助理架构师，主要负责web应用设计和架构。 
最近几年，关注云技术对web应用架构和开发方式的影响。
从2015年初开始学习并关注容器技术，并在个人业余项目中实践用Git和Docker搭建在线开发环境。
- Github: [@yanqiw](https://github.com/yanqiw)
- Twitter: [@yanqiw](https://twitter.com/yanqiw)
- [frankwang.cn](http://frankwang.cn/#/)


##免责声明
以下分享的内容是个人在业余时间的一些经验，并不代表IBM的观点。

#分享内容
##为什么要在云端搭建开发环境
如今，在传统的开发模式下，版本控制，自动化测试，持续集成都已经陆陆续续放到的云端。
- 测试工程师，可以用过自动化测试脚本在云端做大规模的回归测试
- 运维工程师，可以通过自动化的部署工具在云端快速部署应用
- 产品负责人，可以通过版本控制工具控制产品的发布

唯独开发工程师还在利用手中的电脑，笔记本等设备来完成开发工作。
在项目开发阶段，我们通常面临下面几个问题：
- 在项目启动阶段，如何让开发工程师快速搭建，并配置开发环境，来缩短项目启动时间和成本。
- 在项目开发阶段，如何让开发工程师有：
    * 完全相同的开发环境，来降低调试成本。
    * 近似于产品环境的架构，来降低部署时因环境差异带来的风险。
    * 降低对开发设备性能和种类要求，来降低设备成本。
    * 灵活的分配开发资源（CPU，内存，存储），让需要大量开发资源的工程师快速拿到资源。

###云端开发环境要解决的问题总结
基于以上思考，我总结了以下4个云端开发环境要解决的问题：
- 保证每个开发工程师都能快速的获得一致的“开箱即用”的开发环境
- 开发环境摆脱开发设备的种种限制，例如操作系统，设备性能
- 让开发环境尽可能模拟产品环境的结构。
- 灵活的分配开发资源


##在云端搭建开发环境的挑战
一个“开箱即用”的开发环境应该包括：功能完备的代码编辑器， 一个应用运行环境，一个调试工具箱。
- 为了摆脱设备的限制，集成开发环境可以用HTML5等主流浏览器兼容技术实现。
- 为了灵活的分配资源和模拟产品环境，可以将应用运行环境放在云端，并使用容器技术配置。
- 调试工具包括日志的输出，断点等功能。

###技术难点总结
- 在线的集成开发环境：兼容各大主流浏览器
- 隔离的运行环境：隔离，可定制，高效
- 调试代码：查看日志，可设置跟踪断点

##潜在的可选技术
基于技术难点，我做了一些调查研究，选择了几个备选的开源技术。
- 在线集成开发环境
    - [ICEcoder](http://codiad.com/)
    - [Eclipse Orino](https://orionhub.org/)
    - [Codiad](https://icecoder.net/)
- 隔离的运行环境
    - 云端虚拟机
    - Docker
- 代码调试
    - 日志：[fluentd](http://www.fluentd.org/)
    - 断掉调试：目前没有什么解决方案
    
目前，只确定了使用Docker来实现运行环境。

集成在线开发环境，我使用Git来解耦代码运行环境和编辑环境，并代码同步。

代码调试，我使用独立的fluentd服务收集日志，通过SSH登录到虚拟机查看fluent收集的Docker日志。

##云端开发环境的架构概要
下面这张图是一个简单的架构说明。首先，使用Git来解耦代码的编辑和运行环境。
我在云端，使用Docker搭建了Git裸库，裸库中用Git hook来同步代码。使用Docker来运行应用，通过浏览器来检查结果。

因为，代码的编辑和运行环境的分离，开发工程师可以灵活的选择开发工具。开发工具可以是在线编辑器，也可以是本地的编辑器。
借助于Docker的灵活性，开发工程师可以快速配置出应用运行环境，并分享给开发团队成员。
![架构概要](http://frankwang.cn/img/Architecture_Overview.png)

##概念验证
- 在本地编辑代码
- 用Git同步到云端
- 用docker运行代码查看结果

###一小段视频录像，演示如何在云端使用开发环境（制作中）
[视频演示如何在云端进行Django项目开发](http://v.youku.com/v_show/id_XMTQyODEwNDQ3Ng==.html)

##详细步骤
参考[在线开发环境实践](https://github.com/yanqiw/online-development-runtime-practices)

